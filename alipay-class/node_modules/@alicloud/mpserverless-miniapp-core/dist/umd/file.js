"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const mp_file_service_1 = require("@alicloud/mp-file-service");
const mpserverless_core_1 = require("@alicloud/mpserverless-core");
class HighFileSevice extends mp_file_service_1.MPFileService {
    constructor(transport, options) {
        super(transport, options);
        mpserverless_core_1.assert(options.getFileUploadInfo, '[MPFileService]初始化时缺少 getFileUploadInfo 参数');
        this.getFileUploadInfo = options.getFileUploadInfo;
    }
    uploadFile(options) {
        const _super = Object.create(null, {
            uploadFile: { get: () => super.uploadFile }
        });
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const fileInfoRes = yield this.getFileUploadInfo({
                filePath: options.filePath,
            });
            const { fileSize, fileExtension } = fileInfoRes.body;
            if (fileSize) {
                options.fileSize = fileSize;
            }
            if (fileExtension) {
                options.extension = fileExtension;
            }
            return yield _super.uploadFile.call(this, options);
        });
    }
}
exports.HighFileSevice = HighFileSevice;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9maWxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLCtEQUE2RTtBQUM3RSxtRUFBb0U7QUFFcEUsTUFBYSxjQUFlLFNBQVEsK0JBQWE7SUFHL0MsWUFBWSxTQUF3QixFQUFFLE9BQVk7UUFDaEQsS0FBSyxDQUFDLFNBQVMsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUUxQiwwQkFBTSxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsRUFBRSw0Q0FBNEMsQ0FBQyxDQUFDO1FBRWhGLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxPQUFPLENBQUMsaUJBQWlCLENBQUM7SUFDckQsQ0FBQztJQU1ZLFVBQVUsQ0FBRSxPQUEwQjs7Ozs7WUFDakQsTUFBTSxXQUFXLEdBQUcsTUFBTSxJQUFJLENBQUMsaUJBQWlCLENBQUM7Z0JBQy9DLFFBQVEsRUFBRSxPQUFPLENBQUMsUUFBUTthQUMzQixDQUFDLENBQUM7WUFDSCxNQUFNLEVBQUUsUUFBUSxFQUFFLGFBQWEsRUFBRSxHQUFHLFdBQVcsQ0FBQyxJQUFJLENBQUM7WUFFckQsSUFBSSxRQUFRLEVBQUU7Z0JBQ1osT0FBTyxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7YUFDN0I7WUFDRCxJQUFJLGFBQWEsRUFBRTtnQkFDakIsT0FBTyxDQUFDLFNBQVMsR0FBRyxhQUFhLENBQUM7YUFDbkM7WUFFRCxPQUFPLE1BQU0sT0FBTSxVQUFVLFlBQUMsT0FBTyxDQUFDLENBQUM7UUFDekMsQ0FBQztLQUFBO0NBQ0Y7QUE5QkQsd0NBOEJDIn0=