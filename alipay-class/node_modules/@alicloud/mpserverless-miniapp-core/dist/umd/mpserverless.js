"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const mpserverless_core_1 = require("@alicloud/mpserverless-core");
const mp_proxy_service_1 = require("@alicloud/mp-proxy-service");
const mp_db_service_1 = require("@alicloud/mp-db-service");
const mp_user_service_1 = require("@alicloud/mp-user-service");
const mp_function_service_1 = require("@alicloud/mp-function-service");
const transport_1 = require("./transport");
const file_1 = require("./file");
class MPServerlessMiniAppCore extends mpserverless_core_1.MPServerlessCore {
    constructor(appGlobal, options) {
        super(Object.assign(Object.assign({}, options), { httpTransport: transport_1.MPHTTPTransport, options: appGlobal.logger }));
        mpserverless_core_1.assert(options.clientSecret, 'clientSecret is required');
        mpserverless_core_1.assert(options.appId, 'appId is required');
        this.user = new mp_user_service_1.UserService(this.transport, {
            getAuthCode: this.transport.wrapApi(appGlobal.getAuthCode),
            request: this.transport.wrapApi(appGlobal.request),
            appId: options.appId,
            appSecret: options.clientSecret,
            ua: this.ua,
        });
        this.transport.setUserService(this.user);
        this.transport.setRequest(this.transport.wrapApi(appGlobal.request));
        this.db = new mp_db_service_1.DbService(this.transport);
        this.file = new file_1.HighFileSevice(this.transport, {
            uploadFile: this.transport.wrapApi(appGlobal.uploadFile),
            getFileUploadInfo: this.transport.wrapApi(appGlobal.getFileUploadInfo),
        });
        this.function = new mp_function_service_1.FunctionService(this.transport);
        this.network = new mp_proxy_service_1.ProxyService(this.transport);
    }
    get version() {
        return VERSION;
    }
    get ua() {
        return PKGUA;
    }
    createTransport(options) {
        super.createTransport(options);
        this.transport.setAppSecret(options.clientSecret).setUA(this.ua);
    }
}
exports.MPServerlessMiniAppCore = MPServerlessMiniAppCore;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXBzZXJ2ZXJsZXNzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL21wc2VydmVybGVzcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG1FQUlxQztBQUNyQyxpRUFBMEQ7QUFDMUQsMkRBQW9EO0FBQ3BELCtEQUF3RDtBQUN4RCx1RUFBZ0U7QUFDaEUsMkNBQThDO0FBQzlDLGlDQUF3QztBQUV4QyxNQUFhLHVCQUF3QixTQUFRLG9DQUFnQjtJQVEzRCxZQUFZLFNBQWMsRUFBRSxPQUFvQjtRQUM5QyxLQUFLLGlDQUFNLE9BQU8sS0FBRSxhQUFhLEVBQUUsMkJBQWUsRUFBRSxPQUFPLEVBQUUsU0FBUyxDQUFDLE1BQU0sSUFBRyxDQUFDO1FBRWpGLDBCQUFNLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSwwQkFBMEIsQ0FBQyxDQUFDO1FBQ3pELDBCQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO1FBQzNDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSw2QkFBVyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDMUMsV0FBVyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUM7WUFDMUQsT0FBTyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUM7WUFDbEQsS0FBSyxFQUFFLE9BQU8sQ0FBQyxLQUFLO1lBQ3BCLFNBQVMsRUFBRSxPQUFPLENBQUMsWUFBWTtZQUMvQixFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUU7U0FDWixDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDckUsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLHlCQUFTLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3hDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxxQkFBYyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDN0MsVUFBVSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUM7WUFDeEQsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLGlCQUFpQixDQUFDO1NBQ3ZFLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxxQ0FBZSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNwRCxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksK0JBQVksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDbEQsQ0FBQztJQU1ELElBQVcsT0FBTztRQUNoQixPQUFPLE9BQU8sQ0FBQztJQUNqQixDQUFDO0lBS0QsSUFBYyxFQUFFO1FBQ2QsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBTVMsZUFBZSxDQUFDLE9BQW9CO1FBQzVDLEtBQUssQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDL0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDbkUsQ0FBQztDQUNGO0FBdERELDBEQXNEQyJ9